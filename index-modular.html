<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weight & Balance Calculator – Professional</title>

    <!-- External CSS -->
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1>Weight & Balance Calculator – Professional</h1>
            <div class="controls">
                <div class="profile-controls">
                    <select id="aircraftProfileSelect" onchange="window.WeightBalance.loadAircraftProfile()">
                        <option value="">Select Aircraft Profile</option>
                    </select>
                    <button class="btn-config" onclick="window.WeightBalance.openProfileModal()">Manage Profiles</button>
                </div>
                <div>
                    <label class="switch">
                        <input type="checkbox" id="unitSwitch">
                        <span class="slider"></span>
                    </label>
                    <span class="switch-label">Metric (kg/m)</span>
                </div>
                <div>
                    <label class="switch">
                        <input type="checkbox" id="themeSwitch">
                        <span class="slider"></span>
                    </label>
                    <span class="switch-label">Light mode</span>
                </div>
            </div>
        </div>

        <!-- MAC Configuration Section -->
        <div class="mac-toggle" id="macToggle" onclick="window.WeightBalance.toggleMacConfig()">
            <span><strong>%MAC Configuration</strong></span>
            <span class="toggle-icon">▼</span>
        </div>

        <div class="mac-config" id="macConfig">
            <div class="mac-field" style="grid-column: 1 / -1;">
                <label for="macFormula">Custom %MAC Formula:</label>
                <input type="text"
                       id="macFormula"
                       value="20 + ((CG - 232.28) / 86.22) * 100"
                       placeholder="Enter formula using 'CG' as variable. Ex: 20 + ((CG - 232.28) / 86.22) * 100"
                       onchange="window.WeightBalance.validateAndUpdateFormula()"
                       oninput="window.WeightBalance.validateAndUpdateFormula()"
                       style="width: 100%; font-family: 'Courier New', monospace; font-size: 14px; padding: 12px;">
            </div>

            <div class="mac-field">
                <label for="macMin">MAC Min (%):</label>
                <input type="number" id="macMin" value="16" step="0.01"
                       onchange="window.WeightBalance.updateMacLimits()"
                       oninput="window.WeightBalance.updateMacLimits()">
            </div>
            <div class="mac-field">
                <label for="macMax">MAC Max (%):</label>
                <input type="number" id="macMax" value="30" step="0.01"
                       onchange="window.WeightBalance.updateMacLimits()"
                       oninput="window.WeightBalance.updateMacLimits()">
            </div>
            <div class="mac-field">
                <button class="btn-config" onclick="window.WeightBalance.resetMacDefaults()">Reset Default</button>
            </div>
            <div class="mac-field">
                <button class="btn-config" onclick="window.WeightBalance.testFormula()">Test Formula</button>
            </div>

            <div class="mac-formula">
                <h4>Formula Information:</h4>
                <div class="mac-formula-text" id="macFormulaDisplay">
                    Current: %MAC = 20 + ((CG - 232.28) / 86.22) × 100
                </div>
                <p><strong>Valid range:</strong> <span id="macRangeDisplay">16% ≤ %MAC ≤ 30%</span></p>
                <p><strong>Instructions:</strong> Use 'CG' as the variable for Center of Gravity. Standard math operators: +, -, *, /, (, )</p>
                <div id="formulaStatus" style="margin-top: 10px; padding: 8px; border-radius: 5px; font-weight: bold;"></div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Station Table -->
            <div class="table-container">
                <table id="stationTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Station</th>
                            <th id="weightHeader">Weight (lb)</th>
                            <th id="armHeader">Arm (in)</th>
                            <th id="momentHeader">Moment/100 (lb·in)</th>
                        </tr>
                    </thead>
                    <tbody id="stationTableBody">
                        <!-- Stations will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Summary and Graph Container -->
            <div class="summary-container">
                <!-- ZFW Summary -->
                <div class="summary-box" id="zfwSummary">
                    <div class="summary-title">Zero Fuel Weight (ZFW)</div>
                    <div class="summary-weight" id="zfwWeight">0.0 lb</div>
                    <div class="summary-cg" id="zfwCG">CG: 0.000 in</div>
                    <div class="summary-cg" id="zfwMAC">%MAC: 0.00%</div>
                </div>

                <!-- TOW Summary -->
                <div class="summary-box" id="towSummary">
                    <div class="summary-title">Take-Off Weight (TOW)</div>
                    <div class="summary-weight" id="towWeight">0.0 lb</div>
                    <div class="summary-cg" id="towCG">CG: 0.000 in</div>
                    <div class="summary-cg" id="towMAC">%MAC: 0.00%</div>
                </div>

                <!-- LDW Summary -->
                <div class="summary-box" id="ldwSummary">
                    <div class="summary-title">Landing Weight (LDW)</div>
                    <div class="summary-weight" id="ldwWeight">0.0 lb</div>
                    <div class="summary-cg" id="ldwCG">CG: 0.000 in</div>
                    <div class="summary-cg" id="ldwMAC">%MAC: 0.00%</div>
                </div>

                <!-- Envelope Graph -->
                <div class="envelope-graph-container">
                    <div class="summary-title">CG Envelope Graph</div>
                    <canvas id="envelopeCanvas" width="300" height="200"></canvas>
                    <div class="graph-controls">
                        <button class="btn-secondary btn-small" id="cgWeightView">CG vs Weight</button>
                        <button class="btn-primary btn-small" id="macWeightView">%MAC vs Weight</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Totals Section -->
        <div class="totals">
            <div class="total-item">
                <div class="total-label">Total Weight</div>
                <div class="total-value" id="totalWeight">0.0 lb</div>
            </div>
            <div class="total-item">
                <div class="total-label">Total Moment</div>
                <div class="total-value" id="totalMoment">0.00</div>
            </div>
            <div class="total-item">
                <div class="total-label">Total ARM</div>
                <div class="total-value" id="totalARM">0.000 in</div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="buttons">
            <div class="btn-group">
                <button class="btn-secondary" onclick="window.WeightBalance.clearAll()">Clear All</button>
                <button class="btn-secondary" onclick="window.WeightBalance.clearSavedData()">Clear Saved Data</button>
                <button class="btn-config" onclick="window.WeightBalance.openCargoModal()">Manage Cargo</button>
                <button class="btn-config" onclick="window.WeightBalance.openFuelModal()">Fuel Sequence</button>
            </div>
            <div class="btn-group">
                <button class="btn-primary" onclick="window.WeightBalance.openHistoryModal()">View History</button>
                <button class="btn-primary" onclick="window.WeightBalance.exportToPDF()">Export PDF</button>
                <button class="btn-primary" onclick="window.WeightBalance.saveCalculation()">Save Calculation</button>
            </div>
        </div>
    </div>

    <!-- Modals would go here but are simplified for this modular version -->
    <!-- In a full implementation, these would be separate components -->

    <!-- External JavaScript Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Application JavaScript Modules -->
    <script type="module" src="assets/js/config.js"></script>
    <script type="module" src="assets/js/calculations.js"></script>
    <script type="module" src="assets/js/storage.js"></script>
    <script type="module" src="assets/js/ui.js"></script>
    <script type="module" src="assets/js/main.js"></script>

    <script>
        // Simple initialization fallback for non-module browsers
        if (!window.WeightBalance) {
            console.warn('Module loading failed, check browser compatibility');
        }
    </script>
</body>
</html>